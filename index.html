<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›»ä¸‰å­æŒ‡æ®ä¸­å¿ƒ v93</title>
    <style>
        :root {
            --primary: #007aff; --warning: #ff9500; --accent: #ff3b30; --phone: #5856d6; --leave: #bd00ff;
            --bg: #f2f2f7; --glass: rgba(255, 255, 255, 0.85); --text: #1c1c1e;
        }
        body { margin: 0; background: radial-gradient(circle at center, #ffffff 0%, var(--bg) 100%); color: var(--text); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.4); border-radius: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        
        .header { width: 90%; max-width: 600px; padding: 20px 0 5px; display: flex; justify-content: space-between; align-items: center; }
        #main-title { font-size: 2rem; font-weight: 800; color: var(--text); }
        .mode-switch { background: #e5e5ea; padding: 4px; border-radius: 12px; display: flex; gap: 4px; }
        .m-btn { border: none; padding: 6px 12px; border-radius: 8px; font-size: 0.7rem; font-weight: bold; cursor: pointer; color: #8e8e93; background: transparent; }
        .m-btn.active { background: #fff; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .dashboard { width: 90%; max-width: 600px; padding: 15px; display: flex; justify-content: space-around; margin-bottom: 15px; }
        .dash-item { text-align: center; }
        .dash-item big { display: block; font-size: 1.5rem; font-weight: 800; color: var(--text); }
        .dash-item small { font-size: 0.6rem; opacity: 0.5; font-weight: bold; }

        .page { width: 95%; max-width: 600px; display: none; padding-bottom: 100px; height: calc(100vh - 320px); overflow-y: auto; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .chart-wrap { position: relative; width: 100%; padding-top: 50px; }
        .podium { width: 100%; height: 35px; background: rgba(0,0,0,0.02); border: 1px dashed rgba(0,0,0,0.05); border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #aaa; letter-spacing: 8px; }
        
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px 8px; }
        .s { aspect-ratio: 1.6; border: 1px solid rgba(0,0,0,0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer; background: #fff; font-weight: 600; color: #8e8e93; position: relative; transition: 0.1s; }
        
        /* 13 å°æº– 25, 41 å°æº– 23 */
        .spec { position: absolute; top: 0px; width: calc((100% - 60px) / 7); z-index: 10; }
        #s-13 { left: calc(((100% - 60px) / 7 + 10px) * 4); } 
        #s-41 { left: calc(((100% - 60px) / 7 + 10px) * 3); } 

        .present { color: var(--primary); border-color: rgba(0, 122, 255, 0.3); }
        .late { color: var(--warning); border-color: var(--warning); background: rgba(255, 149, 0, 0.05); }
        .absent { color: var(--accent); border-color: var(--accent); background: rgba(255, 59, 48, 0.05); }
        .leave { color: var(--leave); border-color: var(--leave); background: rgba(189, 0, 255, 0.05); }
        
        /* æ‰‹æ©Ÿæ¨¡å¼æ¨£å¼ (åƒ…åœ¨æ‰‹æ©Ÿæ¨¡å¼é¡¯ç¤º) */
        .phone-mode-active .s.phone-done { background: var(--phone) !important; color: #fff !important; border-color: var(--phone) !important; box-shadow: 0 2px 8px rgba(88, 86, 214, 0.3); }
        .l-tag { position: absolute; bottom: 1px; font-size: 0.5rem; font-weight: 900; background: rgba(0,0,0,0.05); padding: 0 2px; border-radius: 3px; }

        .list-row { padding: 14px 10px; border-bottom: 1px solid rgba(0,0,0,0.03); display: flex; justify-content: space-between; }
        .nav-footer { position: fixed; bottom: 25px; width: 90%; max-width: 500px; display: flex; padding: 6px; border-radius: 50px; background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.1); justify-content: space-around; z-index: 1000; }
        .nav-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #8e8e93; font-weight: bold; cursor: pointer; border-radius: 40px; font-size: 0.9rem; transition: 0.3s; }
        .nav-btn.active { background: var(--primary); color: #fff; }
    </style>
</head>
<body>

    <div class="header">
        <span id="main-title">é›»ä¸‰å­</span>
        <div class="mode-switch glass-panel">
            <button class="m-btn active" id="m-att" onclick="setMode('attend')">é»å</button>
            <button class="m-btn" id="m-pho" onclick="setMode('phone')">æ‰‹æ©Ÿ</button>
        </div>
    </div>

    <div class="dashboard glass-panel">
        <div class="dash-item"><small id="l1">å‡ºå¸­ç‡</small><big id="v1">0%</big></div>
        <div class="dash-item"><small id="l2">åœ¨åº§</small><big id="v2">0</big></div>
        <div class="dash-item"><small id="l3">ç¼ºå‡</small><big id="v3" style="color:var(--accent)">0</big></div>
    </div>

    <div id="p1" class="page active">
        <div id="board-container" class="chart-wrap">
            <div class="s spec present" id="s-13" onclick="h(13)">13</div>
            <div class="s spec present" id="s-41" onclick="h(41)">41</div>
            <div class="podium">COMMANDER PODIUM</div>
            <div id="main-grid" class="grid"></div>
        </div>
        <button onclick="dailyReset()" style="width:100%; margin-top:20px; border:none; background:none; color:#ccc; font-size:0.7rem;">ğŸ”„ é‡ç½®ä»Šæ—¥æ•¸æ“š</button>
    </div>

    <div id="p2" class="page">
        <div class="glass-panel" style="padding: 20px;">
            <h3 style="margin:0 0 15px 0; font-size:1rem;">â± ä»Šæ—¥é»åæ—¥èªŒ</h3>
            <div id="log-list"></div>
        </div>
    </div>

    <div id="p3" class="page">
        <div class="glass-panel" style="padding: 20px;">
            <h3 style="margin:0 0 15px 0; font-size:1rem;">ğŸ“Š ç´¯è¨ˆé²åˆ°æ’è¡Œ</h3>
            <div id="stat-list"></div>
        </div>
    </div>

    <nav class="nav-footer">
        <button class="nav-btn active" onclick="go(1)">é»å</button>
        <button class="nav-btn" onclick="go(2)">æ—¥èªŒ</button>
        <button class="nav-btn" onclick="go(3)">æ’è¡Œ</button>
    </nav>

    <script>
        const layout = [2,0,0,6,20,10,21,12,23,25,34,3,1,33,39,4,19,15,18,24,30,40,5,16,35,29,9,36,32,14,37,17,31,8,7,22,11,26,38,0,0,0];
        let mode = 'attend';

        function go(n) {
            document.querySelectorAll('.page').forEach((p, i) => p.classList.toggle('active', i+1 === n));
            document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', i+1 === n));
            if(n===2) renderLogs(); if(n===3) renderStats();
        }

        function setMode(m) {
            mode = m;
            document.getElementById('m-att').classList.toggle('active', m === 'attend');
            document.getElementById('m-pho').classList.toggle('active', m === 'phone');
            // é—œéµåˆ‡æ›ï¼šæ§åˆ¶æ˜¯å¦é¡¯ç¤ºæ‰‹æ©Ÿç¹³äº¤ç‹€æ…‹
            document.getElementById('board-container').classList.toggle('phone-mode-active', m === 'phone');
            updateDash();
        }

        function init() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = "";
            const att = JSON.parse(localStorage.getItem('e3_st') || '{}');
            const pho = JSON.parse(localStorage.getItem('e3_ph') || '{}');
            const typ = JSON.parse(localStorage.getItem('e3_ty') || '{}');

            [13, 41].forEach(id => renderS(document.getElementById(`s-${id}`), id, att, pho, typ));

            layout.forEach(id => {
                const el = document.createElement('div');
                if (id === 0) { el.style.opacity = "0"; }
                else {
                    el.id = `s-${id}`; el.innerText = id; el.onclick = () => h(id);
                    renderS(el, id, att, pho, typ);
                }
                grid.appendChild(el);
            });
            updateDash();
        }

        function renderS(el, id, att, pho, typ) {
            if(!el) return;
            el.className = `s ${el.classList.contains('spec') ? 'spec' : ''} ${att[id] || 'present'}`;
            if(pho[id] === 'y') el.classList.add('phone-done');
            const old = el.querySelector('.l-tag'); if(old) old.remove();
            if(typ[id]) {
                const s = document.createElement('span'); s.className = 'l-tag'; s.innerText = typ[id];
                el.appendChild(s);
            }
        }

        function h(id) {
            const el = document.getElementById(`s-${id}`);
            let att = JSON.parse(localStorage.getItem('e3_st') || '{}'), pho = JSON.parse(localStorage.getItem('e3_ph') || '{}'), typ = JSON.parse(localStorage.getItem('e3_ty') || '{}');
            const time = new Date().toLocaleTimeString('zh-TW', {hour12:false});

            if(mode === 'attend') {
                if(!att[id] || att[id] === 'present') { att[id] = 'late'; addLog(id, time); addStat(id); }
                else {
                    const c = prompt("å‡åˆ¥: 1.äº‹ 2.ç—… 3.å…¬ 4.ç¼º 5.å›å‡ºå¸­");
                    if(c === "1") { att[id] = 'leave'; typ[id] = 'äº‹'; }
                    else if(c === "2") { att[id] = 'leave'; typ[id] = 'ç—…'; }
                    else if(c === "3") { att[id] = 'leave'; typ[id] = 'å…¬'; }
                    else if(c === "4") { att[id] = 'absent'; delete typ[id]; }
                    else if(c === "5") { att[id] = 'present'; delete typ[id]; }
                }
            } else {
                pho[id] = (pho[id] === 'y') ? 'n' : 'y';
            }
            localStorage.setItem('e3_st', JSON.stringify(att)); localStorage.setItem('e3_ph', JSON.stringify(pho)); localStorage.setItem('e3_ty', JSON.stringify(typ));
            init();
        }

        function updateDash() {
            let p = 0, ph = 0, a = 0;
            document.querySelectorAll('.s').forEach(el => {
                if (el.innerText.trim() !== "") {
                    if (el.classList.contains('present')) p++;
                    if (el.classList.contains('phone-done')) ph++;
                    if (el.classList.contains('late') || el.classList.contains('absent') || el.classList.contains('leave')) a++;
                }
            });
            const v1 = (mode === 'attend') ? Math.round((p/41)*100) : Math.round((ph/41)*100);
            document.getElementById('v1').innerText = v1 + "%";
            document.getElementById('v2').innerText = (mode === 'attend') ? p : ph;
            document.getElementById('v3').innerText = (mode === 'attend') ? a : (41-ph);
            
            // æ¨™ç±¤åˆ‡æ›
            if(mode === 'attend') {
                document.getElementById('l1').innerText = "å‡ºå¸­ç‡"; document.getElementById('l2').innerText = "åœ¨åº§"; document.getElementById('l3').innerText = "ç¼ºå‡";
            } else {
                document.getElementById('l1').innerText = "ç¹³äº¤ç‡"; document.getElementById('l2').innerText = "å·²äº¤"; document.getElementById('l3').innerText = "æœªäº¤";
            }
        }

        function addLog(id, t) {
            let logs = JSON.parse(localStorage.getItem('e3_lg') || '[]');
            logs.unshift({id: id, time: t}); localStorage.setItem('e3_lg', JSON.stringify(logs.slice(0, 50)));
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('e3_lg') || '[]');
            document.getElementById('log-list').innerHTML = logs.map(o => `<div class="list-row"><span>åº§è™Ÿ ${o.id}</span><span style="color:var(--warning); font-weight:bold;">${o.time}</span></div>`).join('') || '<div style="opacity:0.2;text-align:center;padding:20px;">å°šç„¡ä»Šæ—¥æ—¥èªŒ</div>';
        }

        function addStat(id) {
            let stats = JSON.parse(localStorage.getItem('e3_stats') || '{}');
            stats[id] = (stats[id] || 0) + 1; localStorage.setItem('e3_stats', JSON.stringify(stats));
        }

        function renderStats() {
            const stats = JSON.parse(localStorage.getItem('e3_stats') || '{}');
            const sorted = Object.entries(stats).sort((a,b) => b[1] - a[1]);
            document.getElementById('stat-list').innerHTML = sorted.map(([id, count]) => `<div class="list-row"><span>åº§è™Ÿ ${id}</span><span style="font-weight:bold;">${count} æ¬¡</span></div>`).join('') || '<div style="opacity:0.2;text-align:center;padding:20px;">ç„¡æ’è¡Œæ•¸æ“š</div>';
        }

        function dailyReset() { if(confirm("é‡ç½®æ•¸æ“šï¼Ÿ")) { localStorage.removeItem('e3_st'); location.reload(); } }
        window.onload = init;
    </script>
</body>
</html>
