<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›»ä¸‰å­æˆ°è¡“æŒ‡æ®ä¸­å¿ƒ v99</title>
    <style>
        :root {
            --primary: #007aff; --warning: #ff9500; --accent: #ff3b30; --phone: #5856d6;
            --bg: #f2f2f7; --glass: rgba(255, 255, 255, 0.9); --text: #1c1c1e;
        }
        body { margin: 0; background: #fff; background-image: radial-gradient(var(--bg) 20%, transparent 20%), radial-gradient(var(--bg) 20%, transparent 20%); background-position: 0 0, 10px 10px; background-size: 20px 20px; color: var(--text); font-family: -apple-system, system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; }
        
        /* ç»ç’ƒé¢æ¿ */
        .glass { background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 8px 32px rgba(0,0,0,0.05); }

        /* é ‚éƒ¨å°èˆª */
        .header { width: 95%; max-width: 600px; padding: 15px; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-radius: 20px; }
        .title-area h1 { margin: 0; font-size: 1.5rem; font-weight: 900; background: linear-gradient(45deg, var(--primary), var(--phone)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* åˆ†é åˆ‡æ›å™¨ */
        .tab-bar { position: fixed; bottom: 20px; width: 92%; max-width: 500px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 8px; border-radius: 25px; z-index: 100; }
        .tab-btn { border: none; background: transparent; padding: 10px 0; border-radius: 15px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; color: #8e8e93; transition: 0.3s; }
        .tab-btn.active { background: #fff; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .tab-btn span { font-size: 0.65rem; font-weight: bold; }

        /* ä¸»å®¹å™¨ */
        .main-content { width: 95%; max-width: 600px; height: calc(100vh - 220px); overflow-y: auto; padding: 10px 0; margin-top: 10px; }
        .view { display: none; width: 100%; }
        .view.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å„€è¡¨æ¿ */
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .dash-card { padding: 15px; border-radius: 18px; text-align: center; }
        .dash-card big { display: block; font-size: 1.4rem; font-weight: 800; }
        .dash-card small { font-size: 0.6rem; opacity: 0.5; font-weight: bold; }

        /* åº§ä½å€ä½ˆå±€ */
        .podium-row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 25px; }
        .podium-box { grid-column: 4; height: 45px; border: 2px dashed #ddd; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #bbb; letter-spacing: 3px; }

        .seat-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px 8px; }
        .s { aspect-ratio: 1.5; background: #fff; border: 1.5px solid #eee; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.2s; color: #d1d1d6; }
        
        /* ç‹€æ…‹æ¨™è¨˜ */
        .present { color: var(--primary); border-color: var(--primary); background: rgba(0, 122, 255, 0.03); }
        .late { color: var(--warning); border-color: var(--warning); background: rgba(255, 149, 0, 0.05); }
        .absent { color: var(--accent); border-color: var(--accent); background: rgba(255, 59, 48, 0.05); }
        .leave { color: #bd00ff; border-color: #bd00ff; background: rgba(189, 0, 255, 0.05); }
        
        /* æ‰‹æ©Ÿæ¨¡å¼å°ˆå±¬ï¼šæ ¼å­è®Šç´« */
        .phone-view .s.ph-done { background: var(--phone) !important; color: #fff !important; border-color: var(--phone) !important; }

        /* çµ±è¨ˆåˆ—è¡¨ */
        .stat-list { display: flex; flex-direction: column; gap: 10px; }
        .stat-row { padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .reset-area { padding: 30px; text-align: center; }
        .btn-danger { background: var(--accent); color: #fff; border: none; padding: 12px 24px; border-radius: 12px; font-weight: bold; }
    </style>
</head>
<body>

    <header class="header glass">
        <div class="title-area">
            <h1>é›»ä¸‰å­</h1>
        </div>
        <div id="status-tag" style="font-size: 0.7rem; font-weight: bold; background: #eee; padding: 4px 10px; border-radius: 10px;">ç³»çµ±å°±ç·’</div>
    </header>

    <div class="main-content">
        <div id="v-attend" class="view active">
            <div class="dashboard">
                <div class="dash-card glass"><small>å‡ºå¸­ç‡</small><big id="att-rate">100%</big></div>
                <div class="dash-card glass"><small>åœ¨åº§</small><big id="att-count">41</big></div>
                <div class="dash-card glass"><small>ç¼ºå¸­</small><big id="att-abs" style="color:var(--accent)">0</big></div>
            </div>
            
            <div class="podium-row">
                <div class="s present" id="s-13" style="grid-column: 2" onclick="toggle(13)">13</div>
                <div class="s present" id="s-41" style="grid-column: 3" onclick="toggle(41)">41</div>
                <div class="podium-box">è¬›æ¡Œ</div>
                <div class="s present" id="s-28" style="grid-column: 5" onclick="toggle(28)">28</div>
                <div class="s present" id="s-27" style="grid-column: 6" onclick="toggle(27)">27</div>
            </div>
            <div id="grid-attend" class="seat-grid"></div>
        </div>

        <div id="v-phone" class="view phone-view">
            <div class="dashboard">
                <div class="dash-card glass"><small>æ‰‹æ©Ÿç¹³äº¤ç‡</small><big id="ph-rate">0%</big></div>
                <div class="dash-card glass"><small>å·²ç¹³</small><big id="ph-count">0</big></div>
                <div class="dash-card glass"><small>æœªç¹³</small><big id="ph-miss">41</big></div>
            </div>
            <div id="grid-phone"></div> </div>

        <div id="v-stats" class="view">
            <div class="stat-list">
                <div class="stat-row glass"><span>æ‡‰åˆ°äººæ•¸</span><b>41</b></div>
                <div class="stat-row glass"><span>ç›®å‰åœ¨åº§</span><b id="st-p">41</b></div>
                <div class="stat-row glass"><span>é²åˆ°/è«‹å‡</span><b id="st-l">0</b></div>
                <div class="stat-row glass" style="border-left: 5px solid var(--phone)"><span>æ‰‹æ©Ÿå·²æ”¶</span><b id="st-ph">0</b></div>
                <div class="stat-row glass"><span>æ›´æ–°æ™‚é–“</span><b id="st-time">--</b></div>
            </div>
        </div>

        <div id="v-info" class="view">
            <div class="reset-area glass">
                <h3>æ•¸æ“šç®¡ç†</h3>
                <p style="font-size: 0.8rem; opacity: 0.6;">æ­¤æ“ä½œå°‡æ¸…é™¤æ‰€æœ‰æœ¬åœ°å„²å­˜çš„é»åèˆ‡æ‰‹æ©Ÿç‹€æ…‹æ•¸æ“šã€‚</p>
                <button class="btn-danger" onclick="dailyReset()">æ¸…é™¤ä»Šæ—¥æ•¸æ“š</button>
            </div>
        </div>
    </div>

    <nav class="tab-bar glass">
        <button class="tab-btn active" onclick="showView('attend')">ğŸ“<span>é»å</span></button>
        <button class="tab-btn" onclick="showView('phone')">ğŸ“±<span>æ‰‹æ©Ÿ</span></button>
        <button class="tab-btn" onclick="showView('stats')">ğŸ“Š<span>çµ±è¨ˆ</span></button>
        <button class="tab-btn" onclick="showView('info')">âš™ï¸<span>è¨­å®š</span></button>
    </nav>

    <script>
        // åš´æ ¼æŒ‰ç…§ç¢ºèªçš„å…¶é¤˜ 36 äººç¶²æ ¼ä½ˆå±€
        const gridData = [
            2, 0, 0, 6, 20, 10, 21,
            12, 23, 25, 34, 3, 1, 33,
            39, 4, 19, 15, 18, 24, 30,
            40, 5, 16, 35, 29, 9, 36,
            32, 14, 37, 17, 31, 8, 7,
            22, 11, 26, 38, 0, 0, 0
        ];

        let currentView = 'attend';

        function showView(v) {
            currentView = v;
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById('v-' + v).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderAll();
        }

        function init() {
            renderAll();
            setInterval(() => { document.getElementById('st-time').innerText = new Date().toLocaleTimeString(); }, 1000);
        }

        function renderAll() {
            const att = JSON.parse(localStorage.getItem('e3_att') || '{}');
            const pho = JSON.parse(localStorage.getItem('e3_pho') || '{}');

            // æ¸²æŸ“è­·æ³•åº§ä½
            [13, 41, 28, 27].forEach(id => {
                const el = document.getElementById(`s-${id}`);
                applyState(el, id, att, pho);
            });

            // æ¸²æŸ“ç¶²æ ¼ (é»ååˆ†é èˆ‡æ‰‹æ©Ÿåˆ†é )
            const gAttend = document.getElementById('grid-attend');
            gAttend.innerHTML = "";
            
            // æ‰‹æ©Ÿåˆ†é å°ˆç”¨çš„å®¹å™¨è™•ç†
            const gPhone = document.getElementById('grid-phone');
            gPhone.innerHTML = document.querySelector('.podium-row').outerHTML; // è¤‡è£½è­·æ³•æ’
            const phoneInnerGrid = document.createElement('div');
            phoneInnerGrid.className = "seat-grid";
            gPhone.appendChild(phoneInnerGrid);

            gridData.forEach(id => {
                const seatA = createSeat(id, att, pho);
                gAttend.appendChild(seatA);
                
                const seatP = createSeat(id, att, pho);
                phoneInnerGrid.appendChild(seatP);
            });

            // æ‰‹æ©Ÿåˆ†é ä¸­çš„è­·æ³•é»æ“Šä¿®æ­£
            gPhone.querySelectorAll('.s').forEach(el => {
                const id = el.id.split('-')[1];
                el.onclick = () => toggle(id);
            });

            updateLogic(att, pho);
        }

        function createSeat(id, att, pho) {
            const el = document.createElement('div');
            if (id === 0) { el.style.opacity = "0"; return el; }
            el.className = "s"; el.id = `s-${id}`; el.innerText = id;
            el.onclick = () => toggle(id);
            applyState(el, id, att, pho);
            return el;
        }

        function applyState(el, id, att, pho) {
            if(!el) return;
            el.className = "s " + (att[id] || 'present');
            if(pho[id] === 'y') el.classList.add('ph-done');
        }

        function toggle(id) {
            let att = JSON.parse(localStorage.getItem('e3_att') || '{}');
            let pho = JSON.parse(localStorage.getItem('e3_pho') || '{}');

            if(currentView === 'attend') {
                const s = att[id] || 'present';
                if(s === 'present') att[id] = 'late';
                else if(s === 'late') att[id] = 'absent';
                else if(s === 'absent') att[id] = 'leave';
                else att[id] = 'present';
            } else {
                pho[id] = (pho[id] === 'y') ? 'n' : 'y';
            }
            localStorage.setItem('e3_att', JSON.stringify(att));
            localStorage.setItem('e3_pho', JSON.stringify(pho));
            renderAll();
        }

        function updateLogic(att, pho) {
            const total = 41;
            let presentCount = 0;
            let phoneCount = 0;
            
            // éæ­·æ‰€æœ‰åº§è™Ÿ 1~41
            for(let i=1; i<=41; i++) {
                if((att[i] || 'present') === 'present') presentCount++;
                if(pho[i] === 'y') phoneCount++;
            }

            // æ›´æ–° UI
            document.getElementById('att-rate').innerText = Math.round((presentCount/total)*100) + "%";
            document.getElementById('att-count').innerText = presentCount;
            document.getElementById('att-abs').innerText = total - presentCount;

            document.getElementById('ph-rate').innerText = Math.round((phoneCount/total)*100) + "%";
            document.getElementById('ph-count').innerText = phoneCount;
            document.getElementById('ph-miss').innerText = total - phoneCount;

            document.getElementById('st-p').innerText = presentCount;
            document.getElementById('st-l').innerText = total - presentCount;
            document.getElementById('st-ph').innerText = phoneCount;
        }

        function dailyReset() { if(confirm("ç¢ºå®šé‡ç½®ä»Šæ—¥æ‰€æœ‰æ•¸æ“šï¼Ÿ")) { localStorage.clear(); location.reload(); } }
        window.onload = init;
    </script>
</body>
</html>
