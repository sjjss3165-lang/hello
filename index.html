<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›»ä¸‰å­æŒ‡æ®ä¸­å¿ƒ v88</title>
    <style>
        :root {
            --primary: #007aff; --warning: #ff9500; --accent: #ff3b30; --phone: #5856d6; --leave: #bd00ff;
            --bg: #f2f2f7; --glass: rgba(255, 255, 255, 0.8); --text: #1c1c1e;
        }
        body { margin: 0; background: radial-gradient(circle at center, #ffffff 0%, var(--bg) 100%); color: var(--text); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.4); border-radius: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        .header { width: 90%; max-width: 600px; padding: 20px 0 5px; display: flex; justify-content: space-between; align-items: flex-end; }
        #main-title { font-size: 2rem; font-weight: 800; }
        
        .mode-switch { background: #e5e5ea; padding: 4px; border-radius: 12px; display: flex; gap: 4px; margin: 10px 0; }
        .m-btn { border: none; padding: 6px 15px; border-radius: 8px; font-size: 0.75rem; font-weight: bold; cursor: pointer; transition: 0.3s; color: #8e8e93; background: transparent; }
        .m-btn.active { background: #fff; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .dashboard { width: 90%; max-width: 600px; padding: 15px; display: flex; justify-content: space-around; margin-bottom: 15px; }
        .dash-item { text-align: center; }
        .dash-item big { display: block; font-size: 1.6rem; font-weight: 800; color: var(--text); }
        .dash-item small { font-size: 0.6rem; opacity: 0.5; font-weight: bold; }

        .page { width: 95%; max-width: 600px; padding-bottom: 120px; }
        .chart-wrap { position: relative; width: 100%; padding-top: 50px; } 
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px 8px; }
        
        .s { aspect-ratio: 1.6; border: 1px solid rgba(0,0,0,0.05); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer; background: #fff; font-weight: 600; color: #8e8e93; position: relative; }
        .spec { position: absolute; top: 0px; z-index: 100; width: calc((100% - 48px) / 7); }
        #s-13 { left: calc(((100% - 48px) / 7) + 8px); }
        #s-41 { left: calc((((100% - 48px) / 7) + 8px) * 2); }
        
        .present { color: var(--primary); border-color: rgba(0, 122, 255, 0.4); }
        .late { color: var(--warning); border-color: var(--warning); background: rgba(255, 149, 0, 0.05); }
        .absent { color: var(--accent); border-color: var(--accent); background: rgba(255, 59, 48, 0.05); }
        .leave { color: var(--leave); border-color: var(--leave); background: rgba(189, 0, 255, 0.05); }
        
        /* å‡åˆ¥æ¨™ç±¤ */
        .l-tag { position: absolute; bottom: 1px; font-size: 0.5rem; font-weight: 900; background: rgba(0,0,0,0.05); padding: 0 2px; border-radius: 3px; }

        /* æ‰‹æ©Ÿç¹³äº¤ç‹€æ…‹ (ç´«è‰²å¤–æ¡†èˆ‡é™°å½±ï¼Œä¸è“‹ä½åŸæœ¬é¡è‰²) */
        .s.phone-done::after { content: "ğŸ“±"; position: absolute; top: -5px; right: -5px; font-size: 0.7rem; z-index: 10; }
        .s.phone-done { box-shadow: inset 0 0 0 3px var(--phone); }

        .nav-footer { position: fixed; bottom: 25px; width: 90%; max-width: 500px; display: flex; padding: 6px; border-radius: 50px; background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="header">
        <div id="title-area">
            <span id="main-title">é›»ä¸‰å­</span>
            <div id="mode-text" style="font-size:0.8rem; color:var(--primary); font-weight:bold; margin-top:5px;">æ¨¡å¼ï¼šä¸€èˆ¬é»å</div>
        </div>
        <div class="mode-switch glass-panel">
            <button class="m-btn active" id="btn-attend" onclick="setMode('attend')">é»å</button>
            <button class="m-btn" id="btn-phone" onclick="setMode('phone')">æ”¶æ‰‹æ©Ÿ</button>
        </div>
    </div>

    <div class="dashboard glass-panel">
        <div class="dash-item"><small id="stat-label-1">å‡ºå¸­ç‡</small><big id="rate-val">100%</big></div>
        <div class="dash-item"><small id="stat-label-2">åœ¨åº§</small><big id="p-num">41</big></div>
        <div class="dash-item"><small id="stat-label-3">æœªäº¤/ç¼ºå¸­</small><big id="a-num" style="color:var(--accent)">0</big></div>
    </div>

    <div class="page" style="display:block;">
        <div class="chart-wrap">
            <div class="s spec present" id="s-13" onclick="handleTap(13)">13</div>
            <div class="s spec present" id="s-41" onclick="handleTap(41)">41</div>
            <div id="main-grid" class="grid"></div>
        </div>
    </div>

    <nav class="nav-footer">
        <button onclick="dailyReset()" style="width:100%; border:none; background:none; color:#8e8e93; font-weight:bold; cursor:pointer;">ğŸ”„ é‡ç½®ä»Šæ—¥æ‰€æœ‰æ•¸æ“š</button>
    </nav>

    <script>
        const layout = [2,0,0,6,20,10,21,12,23,25,34,3,1,33,39,4,19,15,18,24,30,40,5,16,35,29,9,36,32,14,37,17,31,8,7,22,11,26,38,0,0,0];
        let currentMode = 'attend';

        function setMode(m) {
            currentMode = m;
            document.getElementById('btn-attend').classList.toggle('active', m === 'attend');
            document.getElementById('btn-phone').classList.toggle('active', m === 'phone');
            document.getElementById('mode-text').innerText = `æ¨¡å¼ï¼š${m === 'attend' ? 'ä¸€èˆ¬é»å' : 'æ‰‹æ©Ÿç¹³äº¤'}`;
            document.getElementById('mode-text').style.color = m === 'attend' ? 'var(--primary)' : 'var(--phone)';
            updateDashboard();
        }

        function init() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = "";
            const attendData = JSON.parse(localStorage.getItem('e3_st') || '{}');
            const phoneData = JSON.parse(localStorage.getItem('e3_ph') || '{}');
            const typeData = JSON.parse(localStorage.getItem('e3_ty') || '{}');

            [13, 41].forEach(id => {
                const el = document.getElementById(`s-${id}`);
                applyStatus(el, id, attendData, phoneData, typeData);
            });

            layout.forEach(id => {
                if (id === 0) { grid.appendChild(document.createElement('div')).style.opacity = "0"; }
                else {
                    const el = document.createElement('div');
                    el.id = `s-${id}`; el.innerText = id;
                    el.onclick = () => handleTap(id);
                    applyStatus(el, id, attendData, phoneData, typeData);
                    grid.appendChild(el);
                }
            });
            updateDashboard();
        }

        function applyStatus(el, id, att, ph, ty) {
            el.className = `s ${el.classList.contains('spec') ? 'spec' : ''}`;
            const s = att[id] || 'present';
            el.classList.add(s);
            if(ph[id] === 'done') el.classList.add('phone-done');
            if(ty[id]) {
                const span = document.createElement('span');
                span.className = 'l-tag'; span.innerText = ty[id];
                el.appendChild(span);
            }
        }

        function handleTap(id) {
            const el = document.getElementById(`s-${id}`);
            let att = JSON.parse(localStorage.getItem('e3_st') || '{}');
            let ph = JSON.parse(localStorage.getItem('e3_ph') || '{}');
            let ty = JSON.parse(localStorage.getItem('e3_ty') || '{}');

            if(currentMode === 'attend') {
                if(el.classList.contains('present')) {
                    el.classList.replace('present', 'late');
                    att[id] = 'late';
                } else if(el.classList.contains('late') || el.classList.contains('leave') || el.classList.contains('absent')) {
                    const choice = prompt("é¸æ“‡å‡åˆ¥ï¼š1.äº‹ 2.ç—… 3.å…¬ 4.ç¼ºå¸­ 5.æ’¤éŠ·(å›å‡ºå¸­)");
                    const map = {"1":"äº‹","2":"ç—…","3":"å…¬"};
                    
                    // æ¸…é™¤èˆŠæ¨™ç±¤
                    const oldTag = el.querySelector('.l-tag');
                    if(oldTag) oldTag.remove();

                    if(choice === "5") {
                        el.className = `s ${el.classList.contains('spec') ? 'spec' : ''} present ${ph[id]==='done'?'phone-done':''}`;
                        att[id] = 'present'; delete ty[id];
                    } else if(choice === "4" || choice === null) {
                        el.className = `s ${el.classList.contains('spec') ? 'spec' : ''} absent ${ph[id]==='done'?'phone-done':''}`;
                        att[id] = 'absent'; delete ty[id];
                    } else if(map[choice]) {
                        el.className = `s ${el.classList.contains('spec') ? 'spec' : ''} leave ${ph[id]==='done'?'phone-done':''}`;
                        att[id] = 'leave'; ty[id] = map[choice];
                        const span = document.createElement('span');
                        span.className = 'l-tag'; span.innerText = ty[id];
                        el.appendChild(span);
                    }
                }
            } else {
                el.classList.toggle('phone-done');
                ph[id] = el.classList.contains('phone-done') ? 'done' : 'none';
            }
            
            localStorage.setItem('e3_st', JSON.stringify(att));
            localStorage.setItem('e3_ph', JSON.stringify(ph));
            localStorage.setItem('e3_ty', JSON.stringify(ty));
            updateDashboard();
        }

        function updateDashboard() {
            const all = document.querySelectorAll('.s');
            let p = 0, a = 0, ph = 0;
            all.forEach(el => {
                if(el.classList.contains('present')) p++;
                if(el.classList.contains('late') || el.classList.contains('absent') || el.classList.contains('leave')) a++;
                if(el.classList.contains('phone-done')) ph++;
            });

            if(currentMode === 'attend') {
                document.getElementById('stat-label-1').innerText = "å‡ºå¸­ç‡";
                document.getElementById('rate-val').innerText = Math.round((p / 41) * 100) + "%";
                document.getElementById('stat-label-2').innerText = "åœ¨åº§";
                document.getElementById('p-num').innerText = p;
                document.getElementById('stat-label-3').innerText = "ç¼ºå‡";
                document.getElementById('a-num').innerText = a;
            } else {
                document.getElementById('stat-label-1').innerText = "ç¹³äº¤ç‡";
                document.getElementById('rate-val').innerText = Math.round((ph / 41) * 100) + "%";
                document.getElementById('stat-label-2').innerText = "å·²äº¤";
                document.getElementById('p-num').innerText = ph;
                document.getElementById('stat-label-3').innerText = "æœªäº¤";
                document.getElementById('a-num').innerText = 41 - ph;
            }
        }

        function dailyReset() {
            if(confirm("ç¢ºå®šé‡ç½®ä»Šæ—¥æ‰€æœ‰æ•¸æ“šï¼Ÿ")) { localStorage.clear(); location.reload(); }
        }

        window.onload = init;
    </script>
</body>
</html>
