<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>WBC 2026：台日巔峰之戰 (9人完整名單)</title>
    <style>
        :root { --accent: #00f2ff; --bg: #010409; --panel: rgba(15, 23, 42, 0.9); --strike: #facc15; --tw-blue: #0038a8; --jp-red: #bc002d; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; height: 100vh; }
        
        /* 選人介面 */
        #setup-screen { position: absolute; inset: 0; z-index: 1000; background: radial-gradient(circle at center, #001f3f, #000); padding: 20px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        .setup-container { display: flex; gap: 20px; width: 95%; max-width: 1200px; height: 65vh; }
        .pool-box { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--accent); border-radius: 12px; overflow-y: auto; padding: 15px; border-top: 4px solid var(--accent); }
        .p-item { background: #0f172a; padding: 10px; margin: 5px 0; border-radius: 6px; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.85rem; border: 1px solid transparent; }
        .p-item:hover { background: var(--accent); color: #000; }
        .p-item.selected { opacity: 0.3; pointer-events: none; }

        /* 遊戲螢幕 */
        #game-screen { display: none; width: 100%; height: 100vh; flex-direction: column; background: #000; }
        
        /* 轉播計分板 */
        .broadcast-score { position: absolute; top: 20px; left: 30px; background: linear-gradient(90deg, rgba(0,0,0,0.9), rgba(0,0,0,0.5)); border-left: 5px solid var(--accent); padding: 10px 20px; border-radius: 4px; z-index: 500; font-family: 'Arial Black', sans-serif; }
        .score-row { display: flex; align-items: center; gap: 15px; margin: 2px 0; }
        .team-tag { width: 50px; font-weight: 900; }
        .score-num { font-size: 1.2rem; color: var(--accent); }

        .main-layout { display: flex; flex: 1; width: 100%; position: relative; }
        .order-panel { width: 220px; background: rgba(0,0,0,0.8); padding: 15px; border-right: 1px solid #333; z-index: 10; overflow-y: auto; }
        .order-item { padding: 6px; border-radius: 4px; margin-bottom: 4px; color: #666; font-size: 0.8rem; display: flex; justify-content: space-between; border-bottom: 1px solid #222; }
        .order-item.active { background: linear-gradient(90deg, var(--accent), transparent); color: #000; font-weight: bold; border: none; }

        .canvas-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #1e3a8a 0%, #020617 100%); }
        canvas { border-radius: 5px; box-shadow: 0 0 100px rgba(0, 242, 255, 0.1); transition: transform 0.5s; }

        .sidebar { width: 300px; background: var(--panel); padding: 25px; display: flex; flex-direction: column; gap: 15px; border-left: 1px solid #333; }
        .pitch-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { background: rgba(0,0,0,0.5); border: 1px solid var(--accent); color: var(--accent); padding: 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; font-weight: bold; }
        .btn.active { background: var(--accent); color: #000; }

        #swing-btn { width: 100%; padding: 20px; font-size: 1.8rem; font-weight: 900; color: #fff; background: linear-gradient(180deg, #ef4444, #991b1b); border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 6px 0 #7f1d1d; }
        
        .light-group { display: flex; align-items: center; gap: 8px; background: rgba(0,0,0,0.4); padding: 8px 15px; border-radius: 20px; }
        .light { width: 12px; height: 12px; border-radius: 50%; background: #222; }
        .s-on { background: var(--strike); }
        .o-on { background: #ef4444; }

        .feedback-overlay { position: absolute; bottom: 20%; display: flex; flex-direction: column; align-items: center; pointer-events: none; width: 100%; z-index: 600; }
        #speed-text { font-size: 2rem; color: #fff; font-style: italic; font-weight: 900; text-shadow: 0 0 10px var(--accent); }
        #result-text { font-size: 3.5rem; color: var(--strike); font-weight: 900; text-shadow: 0 0 20px #000; }
        
        #start-btn { margin-top: 30px; padding: 15px 60px; background: var(--tw-blue); color: white; border: none; border-radius: 4px; font-size: 1.2rem; font-weight: 900; cursor: pointer; display: none; }
    </style>
</head>
<body>

<div id="setup-screen">
    <h1 style="color:var(--accent); letter-spacing:3px;">2026 WORLD BASEBALL CLASSIC</h1>
    <h3 style="opacity:0.7;">建立中華隊先發名單</h3>
    <div class="setup-container">
        <div class="pool-box"><h4>中華隊選手庫</h4><div id="tw-pool"></div></div>
        <div class="pool-box"><h4>先發陣容 (9打+1投)</h4><div id="my-lineup-display"></div></div>
    </div>
    <button id="start-btn" onclick="beginGame()">開始比賽</button>
</div>

<div id="game-screen">
    <div class="broadcast-score">
        <div class="score-row"><span class="team-tag" style="color:var(--accent)">TPE</span><span class="score-num" id="pr">0</span></div>
        <div class="score-row"><span class="team-tag" style="color:var(--jp-red)">JPN</span><span class="score-num" id="cr">0</span></div>
        <div style="margin-top:10px; font-size:0.8rem; opacity:0.8;" id="inning-tag">TOP 1ST</div>
    </div>

    <div class="main-layout">
        <div class="order-panel" id="order-ui"><div id="order-list"></div></div>
        <div class="canvas-container">
            <div id="msg-ov" style="position:absolute; font-size:5rem; font-weight:900; display:none; z-index:100; color:white;">SWITCH</div>
            <div class="feedback-overlay"><div id="speed-text"></div><div id="result-text"></div></div>
            <canvas id="fieldCanvas" width="800" height="500"></canvas>
        </div>

        <div class="sidebar">
            <div class="light-group">
                S <div id="s1" class="light"></div><div id="s2" class="light"></div>
                <span style="margin-left:10px;"></span>
                O <div id="o1" class="light"></div><div id="o2" class="light"></div>
            </div>
            <div id="base-ui" style="color:var(--accent); font-size:1.8rem; text-align:center; padding:10px;">◇ ◇ ◇</div>
            <div id="pitch-ui"><div class="pitch-menu" id="pitch-buttons"></div></div>
            <div id="bat-ui" style="display:none;"><button id="swing-btn" onclick="swing()">SWING</button></div>
            <div id="matchup" style="border-left:4px solid var(--tw-blue); padding-left:15px; font-size:0.9rem;"></div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('fieldCanvas');
    const ctx = canvas.getContext('2d');

    const TW_PLAYERS = [
        { name: "徐若熙 (2026)", type: "P", speed: 158, signature: ["消失指叉", "火球", "滑球", "曲球"] },
        { name: "古林睿煬 (2026)", type: "P", speed: 158, signature: ["火球", "滑球", "指叉", "變速球"] },
        { name: "張育成", type: "B", avg: .450, pwr: 99 }, { name: "鄭宗哲", type: "B", avg: .560, pwr: 70 },
        { name: "李灝宇", type: "B", avg: .340, pwr: 99 }, { name: "陳傑憲", type: "B", avg: .650, pwr: 65 },
        { name: "吉力吉撈", type: "B", avg: .320, pwr: 99 }, { name: "江坤宇", type: "B", avg: .300, pwr: 55 },
        { name: "林立", type: "B", avg: .345, pwr: 80 }, { name: "陳晨威", type: "B", avg: .310, pwr: 60 },
        { name: "林家正", type: "B", avg: .280, pwr: 50 }, { name: "宋家豪", type: "P", speed: 152, signature: ["圈指變速球", "火球", "伸卡", "滑球"] }
    ];

    // 日本隊 9 人完整打線
    const JP_ORDER = [
        { name: "L.Nootbaar", avg: .320, pwr: 80 },
        { name: "近藤健介", avg: .360, pwr: 70 },
        { name: "大谷翔平", avg: .450, pwr: 99 },
        { name: "村上宗隆", avg: .310, pwr: 98 },
        { name: "吉田正尚", avg: .420, pwr: 85 },
        { name: "岡本和真", avg: .330, pwr: 95 },
        { name: "山田哲人", avg: .280, pwr: 80 },
        { name: "源田壯亮", avg: .260, pwr: 50 },
        { name: "中村悠平", avg: .240, pwr: 45 }
    ];
    const JP_PITCHER = { name: "山本由伸", speed: 158, signature: ["指叉球", "火球", "彩虹曲球", "滑球"] };

    let myLineup = { B: [], P: null }, state = {
        inning: 1, isTop: true, s: 0, o: 0, pScore: 0, cScore: 0,
        twIdx: 0, jpIdx: 0, isAnim: false, pitchType: '', pitchFrame: 0,
        bases: [false, false, false], isBallInFlight: false, trail: [], swingFrame: -1
    };

    function initSetup() {
        const poolEl = document.getElementById('tw-pool');
        TW_PLAYERS.forEach((p, i) => {
            const div = document.createElement('div'); div.className = 'p-item';
            div.innerHTML = `<span>${p.name}</span> <span>${p.type=='P'?'P':'B'}</span>`;
            div.onclick = () => selectPlayer(p, div); poolEl.appendChild(div);
        });
    }

    function selectPlayer(p, el) {
        if (el.classList.contains('selected')) return;
        if (p.type === 'P') { if (myLineup.P) return; myLineup.P = p; }
        else { if (myLineup.B.length >= 9) return; myLineup.B.push(p); }
        el.classList.add('selected');
        document.getElementById('my-lineup-display').innerHTML += `<div class='p-item'>${p.name}</div>`;
        if (myLineup.B.length === 9 && myLineup.P) document.getElementById('start-btn').style.display = 'block';
    }

    function beginGame() {
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        updatePitchMenu(); updateOrderUI(); updateUI(); drawField();
        if (!state.isTop) setTimeout(cpuPitch, 1000);
    }

    function updatePitchMenu() {
        const menu = document.getElementById('pitch-buttons'); menu.innerHTML = '';
        const currP = state.isTop ? myLineup.P : JP_PITCHER;
        currP.signature.forEach((s, i) => {
            const btn = document.createElement('button'); btn.className = `btn ${i === 0 ? 'active' : ''}`; btn.innerText = s;
            if (i === 0) state.pitchType = s;
            btn.onclick = () => { state.pitchType = s; document.querySelectorAll('.pitch-menu .btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); };
            menu.appendChild(btn);
        });
    }

    function updateOrderUI() {
        const list = document.getElementById('order-list'), order = state.isTop ? JP_ORDER : myLineup.B, idx = state.isTop ? state.jpIdx % 9 : state.twIdx % 9;
        list.innerHTML = ''; 
        order.forEach((p, i) => {
            const div = document.createElement('div'); div.className = `order-item ${i === idx ? 'active' : ''}`;
            div.innerHTML = `<span>${i+1}</span> <span>${p.name}</span>`; list.appendChild(div);
        });
    }

    function drawField() {
        // 電視轉播色調草地
        const grd = ctx.createRadialGradient(400, 450, 50, 400, 450, 600);
        grd.addColorStop(0, "#2d4a10"); grd.addColorStop(1, "#064e3b");
        ctx.fillStyle = grd; ctx.fillRect(0, 0, 800, 500);
        // 打擊區
        ctx.fillStyle = "#5d2710"; ctx.beginPath(); ctx.ellipse(400, 420, 150, 60, 0, 0, Math.PI * 2); ctx.fill();
        // 九宮格
        ctx.strokeStyle = "rgba(255,255,255,0.1)"; ctx.strokeRect(300, 150, 200, 200);
        // 投手
        ctx.strokeStyle = "#fff"; ctx.lineWidth = 4; ctx.beginPath(); ctx.arc(400, 380, 10, 0, Math.PI*2); ctx.stroke();
        ctx.moveTo(400, 390); ctx.lineTo(400, 430); ctx.stroke();
        // 揮棒動畫
        if (state.swingFrame >= 0) {
            let progress = state.swingFrame / 12;
            let angle = -Math.PI / 3 + progress * Math.PI * 1.2;
            ctx.save(); ctx.translate(400, 380); ctx.rotate(angle);
            ctx.fillStyle = "rgba(251, 191, 36, 0.4)"; ctx.fillRect(0, -8, 120, 16);
            ctx.fillStyle = "#fbbf24"; ctx.fillRect(0, -6, 110, 12); ctx.restore();
            state.swingFrame++; if (state.swingFrame > 12) state.swingFrame = -1;
        }
    }

    canvas.addEventListener('mousedown', (e) => {
        if (state.isAnim || !state.isTop) return;
        const rect = canvas.getBoundingClientRect(); startPitch(e.clientX - rect.left, e.clientY - rect.top);
    });

    function startPitch(tx, ty) {
        state.isAnim = true; state.trail = [];
        let bf = 0; const p = state.isTop ? myLineup.P : JP_PITCHER;
        const spd = Math.floor(p.speed - (state.pitchType.includes("指叉") ? 12 : 0) + (Math.random()*4-2));
        document.getElementById('speed-text').innerText = spd + " KM/H";
        document.getElementById('speed-text').style.display = 'block';

        const fly = () => {
            bf++; state.pitchFrame = bf; state.isBallInFlight = true;
            let pVal = bf/25; 
            let ballSize = 3 + (Math.pow(pVal, 2) * 25);
            let dx = 0, dy = 0;
            let cF = pVal > 0.4 ? Math.pow(pVal - 0.4, 2) * 5 : 0;
            if(state.pitchType.includes("滑球")) dx = cF * -70; 
            if(state.pitchType.includes("曲球")) { dx = cF * -60; dy = cF * 60; }
            if(state.pitchType.includes("指叉") || state.pitchType.includes("變速")) {
                dy = cF * 190; dx = state.pitchType.includes("圈指") ? cF * 50 : cF * -30;
            }
            let visualY = (400 + (ty - dy - 400) * pVal) + dy * Math.pow(pVal, 2);
            let cx = 400 + (tx-400)*pVal + dx;
            state.trail.push({x: cx, y: visualY});
            drawField();
            ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(cx, visualY, ballSize, 0, Math.PI*2); ctx.fill();
            if(bf < 25 && state.isBallInFlight) requestAnimationFrame(fly); 
            else if(state.isBallInFlight) resolve(cx, visualY);
        }; fly();
    }

    function resolve(cx, cy) {
        state.isAnim = false; state.isBallInFlight = false;
        let inZone = cx > 300 && cx < 500 && cy > 150 && cy < 350;
        if (state.isTop) {
            let batter = JP_ORDER[state.jpIdx % 9];
            if (inZone && Math.random() < batter.avg) { showFeedback("", "JPN HIT!"); handleHit(1); }
            else { state.s++; if (state.s >= 3) { state.o++; state.s=0; showFeedback("", "STRIKEOUT!"); finishPA(); } }
        } else {
            if (inZone) state.s++; 
            if (state.s >= 3) { state.o++; state.s=0; showFeedback("", "STRIKEOUT!"); finishPA(); }
        }
        checkInning(); updateUI();
    }

    function swing() {
        if (!state.isBallInFlight) return;
        state.swingFrame = 0;
        let timing = "TOO LATE";
        if (state.pitchFrame >= 22 && state.pitchFrame <= 24) timing = "PERFECT";
        else if (state.pitchFrame >= 18 && state.pitchFrame <= 25) timing = "GOOD";

        if (timing === "PERFECT" || (timing === "GOOD" && Math.random() < myLineup.B[state.twIdx%9].avg)) {
            let bases = timing === "PERFECT" ? 2 : 1;
            handleHit(bases); showFeedback(timing, bases==2?"XBH!":"BASE HIT!"); state.isBallInFlight = false;
        } else {
            state.s++; showFeedback(timing, "SWING & MISS");
            if (state.s >= 3) { state.o++; state.s=0; showFeedback("", "STRIKEOUT!"); finishPA(); }
            state.isBallInFlight = false;
        }
        checkInning(); updateUI();
    }

    function handleHit(bases) {
        for (let i = 2; i >= 0; i--) { if (state.bases[i]) { if (i + bases >= 3) { if(state.isTop) state.cScore++; else state.pScore++; state.bases[i]=false; } else { state.bases[i+bases]=true; state.bases[i]=false; } } }
        state.bases[bases-1] = true; state.s = 0; finishPA();
    }

    function finishPA() { if (state.isTop) state.jpIdx++; else state.twIdx++; updateOrderUI(); }

    function checkInning() {
        if (state.o >= 3) {
            state.o = 0; state.s = 0; state.bases = [false, false, false]; state.isTop = !state.isTop;
            if (state.isTop) state.inning++;
            const ov = document.getElementById('msg-ov'); ov.style.display = 'block'; setTimeout(()=>ov.style.display='none', 1500);
            updateOrderUI(); updatePitchMenu();
        }
        document.getElementById('pitch-ui').style.display = state.isTop ? 'block' : 'none';
        document.getElementById('bat-ui').style.display = state.isTop ? 'none' : 'block';
        if (!state.isTop && !state.isAnim && !state.isBallInFlight) setTimeout(cpuPitch, 2000);
    }

    function cpuPitch() { if (state.isTop) return; state.pitchType = JP_PITCHER.signature[Math.floor(Math.random()*4)]; startPitch(320+Math.random()*160, 180+Math.random()*140); }

    function showFeedback(timing, result) {
        const t = document.getElementById('timing-text'), r = document.getElementById('result-text');
        t.innerText = timing; r.innerText = result; t.style.display = timing ? 'block' : 'none'; r.style.display = 'block';
        setTimeout(() => { t.style.display = 'none'; r.style.display = 'none'; document.getElementById('speed-text').style.display = 'none'; }, 1500);
    }

    function updateUI() {
        document.getElementById('pr').innerText = state.pScore; document.getElementById('cr').innerText = state.cScore;
        document.getElementById('inning-tag').innerText = `${state.isTop?'TOP':'BOT'} ${state.inning}`;
        document.getElementById('s1').className = state.s >= 1 ? 'light s-on' : 'light'; document.getElementById('s2').className = state.s >= 2 ? 'light s-on' : 'light';
        document.getElementById('o1').className = state.o >= 1 ? 'light o-on' : 'light'; document.getElementById('o2').className = state.o >= 2 ? 'light o-on' : 'light';
        document.getElementById('base-ui').innerText = state.bases.map(b => b ? "◆" : "◇").join(" ");
        const p = state.isTop ? myLineup.P : JP_PITCHER, b = state.isTop ? JP_ORDER[state.jpIdx%9] : myLineup.B[state.twIdx%9];
        document.getElementById('matchup').innerHTML = `<div style="color:var(--accent)">P: ${p.name}</div><div style="font-weight:900">B: ${b.name}</div>`;
    }

    initSetup();
</script>
</body>
</html>
