<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Èõª‰∏âÂ≠ùÈªûÂêçÁ≥ªÁµ± v98</title>
    <style>
        :root {
            --primary: #007aff; --warning: #ff9500; --accent: #ff3b30; --phone: #5856d6;
            --bg: #f2f2f7; --glass: rgba(255, 255, 255, 0.85); --text: #1c1c1e;
        }
        body { margin: 0; background: radial-gradient(circle at center, #ffffff 0%, var(--bg) 100%); color: var(--text); font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow: hidden; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.4); border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        .header { width: 90%; max-width: 600px; padding: 20px 0 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        #main-title { font-size: 2rem; font-weight: 800; color: var(--text); }
        
        .mode-switch { background: #e5e5ea; padding: 4px; border-radius: 14px; display: flex; gap: 4px; }
        .m-btn { border: none; padding: 8px 14px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; cursor: pointer; color: #8e8e93; background: transparent; transition: 0.2s; }
        .m-btn.active { background: #fff; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }

        .dashboard { width: 90%; max-width: 600px; padding: 15px; display: flex; justify-content: space-around; margin-bottom: 15px; }
        .dash-item { text-align: center; }
        .dash-item big { display: block; font-size: 1.6rem; font-weight: 800; color: var(--text); }
        .dash-item small { font-size: 0.6rem; opacity: 0.5; font-weight: bold; }

        .page { width: 95%; max-width: 600px; padding-bottom: 100px; height: calc(100vh - 320px); overflow-y: auto; }
        .chart-wrap { position: relative; width: 100%; padding-top: 10px; } 
        
        /* Ë¨õÊ°åÁ¨¨‰∏ÄÊéíË≠∑Ê≥ï (28, 13, Podium, 41, 27) */
        .podium-row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px 8px; margin-bottom: 20px; align-items: center; }
        .podium-box { grid-column: 4; height: 40px; border: 1px dashed rgba(0,0,0,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #aaa; letter-spacing: 4px; }

        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px 8px; }
        .s { aspect-ratio: 1.6; border: 1px solid rgba(0,0,0,0.05); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer; transition: 0.1s; background: #fff; font-weight: 600; color: #8e8e93; position: relative; }
        
        /* Ëâ≤ÂΩ©ÁãÄÊÖã */
        .present { color: var(--primary); border-color: rgba(0, 122, 255, 0.2); }
        .late { color: var(--warning); border-color: var(--warning); background: rgba(255, 149, 0, 0.05); }
        .absent { color: var(--accent); border-color: var(--accent); background: rgba(255, 59, 48, 0.05); }
        .leave { color: #bd00ff; border-color: #bd00ff; background: rgba(189, 0, 255, 0.05); }
        
        /* ÊâãÊ©üÊ®°ÂºèÊ®£Âºè */
        .phone-mode .s.ph-done { background: var(--phone) !important; color: #fff !important; border-color: var(--phone) !important; box-shadow: 0 4px 12px rgba(88, 86, 214, 0.2); }

        .nav-footer { position: fixed; bottom: 25px; width: 90%; max-width: 500px; display: flex; padding: 10px; border-radius: 50px; justify-content: center; }
        .reset-btn { background: none; border: none; color: #ccc; font-size: 0.7rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <span id="main-title">Èõª‰∏âÂ≠ù</span>
        <div class="mode-switch glass-panel">
            <button class="m-btn active" id="b-att" onclick="setMode('attend')">ÈªûÂêç</button>
            <button class="m-btn" id="b-pho" onclick="setMode('phone')">ÊâãÊ©ü</button>
        </div>
    </div>

    <div class="dashboard glass-panel">
        <div class="dash-item"><small id="l1">Âá∫Â∏≠Áéá</small><big id="v1">100%</big></div>
        <div class="dash-item"><small id="l2">Âú®Â∫ß</small><big id="v2">41</big></div>
        <div class="dash-item"><small id="l3">Áº∫ÂÅá</small><big id="v3" style="color:var(--accent)">0</big></div>
    </div>

    <div class="page active">
        <div class="chart-wrap" id="board-container">
            <div class="podium-row">
                <div class="s present" id="s-28" style="grid-column: 2" onclick="h(28)">28</div>
                <div class="s present" id="s-13" style="grid-column: 3" onclick="h(13)">13</div>
                <div class="podium-box">Ë¨õÊ°å</div>
                <div class="s present" id="s-41" style="grid-column: 5" onclick="h(41)">41</div>
                <div class="s present" id="s-27" style="grid-column: 6" onclick="h(27)">27</div>
            </div>

            <div id="main-grid" class="grid"></div>
        </div>
    </div>

    <nav class="nav-footer glass-panel">
        <button class="reset-btn" onclick="dailyReset()">üîÑ RESET DATA</button>
    </nav>

    <script>
        const layout = [
            2, 12, 23, 25, 34, 3, 1,
            33, 39, 4, 19, 15, 18, 24,
            30, 40, 5, 16, 35, 29, 9,
            36, 32, 14, 37, 17, 31, 8,
            7, 22, 11, 26, 38, 0, 0, 0, 0
        ];

        let mode = 'attend';

        function setMode(m) {
            mode = m;
            document.getElementById('b-att').classList.toggle('active', m === 'attend');
            document.getElementById('b-pho').classList.toggle('active', m === 'phone');
            document.getElementById('board-container').classList.toggle('phone-mode', m === 'phone');
            updateDash();
        }

        function init() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = "";
            const att = JSON.parse(localStorage.getItem('e3_st') || '{}');
            const pho = JSON.parse(localStorage.getItem('e3_ph') || '{}');

            // ÂàùÂßãÂåñË¨õÊ°åÁ¨¨‰∏ÄÊéí
            [28, 13, 41, 27].forEach(id => renderS(document.getElementById(`s-${id}`), id, att, pho));

            // ÂàùÂßãÂåñ‰∏ªÁ∂≤Ê†º
            layout.forEach(id => {
                const el = document.createElement('div');
                if (id === 0) { el.style.opacity = "0"; }
                else {
                    el.className = "s"; el.id = `s-${id}`; el.innerText = id;
                    el.onclick = () => h(id);
                    renderS(el, id, att, pho);
                    grid.appendChild(el);
                }
            });
            updateDash();
        }

        function renderS(el, id, att, pho) {
            if(!el) return;
            el.className = "s " + (att[id] || 'present');
            if(pho[id] === 'y') el.classList.add('ph-done');
        }

        function h(id) {
            let att = JSON.parse(localStorage.getItem('e3_st') || '{}');
            let pho = JSON.parse(localStorage.getItem('e3_ph') || '{}');

            if(mode === 'attend') {
                const s = att[id] || 'present';
                if(s === 'present') att[id] = 'late';
                else if(s === 'late') att[id] = 'absent';
                else if(s === 'absent') att[id] = 'leave';
                else att[id] = 'present';
            } else {
                pho[id] = (pho[id] === 'y') ? 'n' : 'y';
            }
            localStorage.setItem('e3_st', JSON.stringify(att));
            localStorage.setItem('e3_ph', JSON.stringify(pho));
            init();
        }

        function updateDash() {
            const seats = document.querySelectorAll('.s:not([style*="opacity:0"])');
            let p = 0, ph = 0, a = 0;
            seats.forEach(s => {
                if(s.classList.contains('present')) p++;
                if(s.classList.contains('ph-done')) ph++;
                if(s.classList.contains('late') || s.classList.contains('absent') || s.classList.contains('leave')) a++;
            });
            const total = 41;
            document.getElementById('v1').innerText = Math.round((p/total)*100) + "%";
            document.getElementById('v2').innerText = (mode === 'attend') ? p : ph;
            document.getElementById('v3').innerText = (mode === 'attend') ? a : (total - ph);
            
            if(mode === 'attend') {
                document.getElementById('l1').innerText = "Âá∫Â∏≠Áéá"; document.getElementById('l2').innerText = "Âú®Â∫ß"; document.getElementById('l3').innerText = "Áº∫ÂÅá";
            } else {
                document.getElementById('l1').innerText = "Áπ≥‰∫§Áéá"; document.getElementById('l2').innerText = "Â∑≤‰∫§"; document.getElementById('l3').innerText = "Êú™‰∫§";
            }
        }

        function dailyReset() { if(confirm("ÈáçÁΩÆÊï∏ÊìöÔºü")) { localStorage.clear(); location.reload(); } }
        window.onload = init;
    </script>
</body>
</html>
