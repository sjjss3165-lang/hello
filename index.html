<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»ä¸‰å­æŒ‡æ®ä¸­å¿ƒ v47</title>
    <style>
        :root {
            --primary: #00d4ff; --accent: #f72585; --warning: #ffb703;
            --bg: #0b0f19; --card: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1);
        }
        body {
            margin: 0; background: var(--bg); color: #e2e8f0; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* é é¢åˆ‡æ›æ©Ÿåˆ¶ */
        .page { width: 95%; max-width: 600px; padding: 15px; display: none; padding-bottom: 90px; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å°èˆªåˆ— */
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: rgba(10, 12, 18, 0.98); display: flex; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-btn { flex: 1; text-align: center; color: #475569; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; justify-content: center; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }

        /* åº§ä½å€ä½ˆå±€ */
        .chart { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .teacher-area { grid-column: span 7; display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-bottom: 15px; align-items: flex-end; }
        .desk { grid-column: 4 / 7; background: rgba(255,255,255,0.03); height: 35px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; color: #444; border: 1px dashed var(--border); }
        
        .s { 
            aspect-ratio: 1.2; border: 1.5px solid var(--border); border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: 0.2s;
        }
        .mini { height: 35px; aspect-ratio: auto; font-size: 0.9rem; }

        .present { border-color: var(--primary); color: var(--primary); }
        .absent { border-color: var(--accent); color: var(--accent); background: rgba(247, 37, 133, 0.15); }
        .late { border-color: var(--warning); color: var(--warning); background: rgba(255, 183, 3, 0.15); }

        /* ç¬¬äºŒé å…ƒä»¶ */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        #gacha-num { font-size: 4rem; text-align: center; color: var(--primary); font-weight: 900; margin: 10px 0; }
        .log-list { font-family: monospace; font-size: 0.85rem; height: 250px; overflow-y: auto; color: #94a3b8; }
        .log-item { padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
    </style>
</head>
<body>

    <div id="p1" class="page active">
        <div id="clock" style="text-align:center; font-size:2.5rem; color:var(--primary); margin: 10px 0;">00:00:00</div>
        
        <div class="chart" id="chart-container">
            <div class="teacher-area">
                <div style="grid-column: 2;"><div class="s mini present" id="s-13" onclick="t(13)">13</div></div>
                <div style="grid-column: 3;"><div class="s mini present" id="s-41" onclick="t(41)">41</div></div>
                <div class="desk">è¬›æ¡Œ / PODIUM</div>
            </div>
        </div>
    </div>

    <div id="p2" class="page">
        <h3 style="color:var(--primary); text-align:center; font-weight:300;">æ•¸æ“šåˆ†æä¸­å¿ƒ</h3>
        
        <div class="card" style="display:flex; justify-content:space-around; text-align:center;">
            <div><div id="cnt-a" style="color:var(--accent); font-size:1.5rem; font-weight:bold;">0</div><small>ç¼ºå¸­</small></div>
            <div><div id="cnt-l" style="color:var(--warning); font-size:1.5rem; font-weight:bold;">0</div><small>é²åˆ°</small></div>
            <div><div id="cnt-p" style="color:var(--primary); font-size:1.5rem; font-weight:bold;">41</div><small>åœ¨åº§</small></div>
        </div>

        <div class="card">
            <small style="color:var(--warning)">éš¨æ©ŸæŠ½äºº (è‡ªå‹•éæ¿¾ç¼ºå¸­)</small>
            <div id="gacha-num">??</div>
            <button onclick="startGacha()" style="width:100%; padding:10px; background:var(--primary); border:none; border-radius:8px; font-weight:bold; cursor:pointer;">START</button>
        </div>

        <div class="card">
            <small style="color:var(--warning)">ğŸ•’ åˆ°æ ¡æ™‚é–“ç™»è¨˜æ—¥èªŒ</small>
            <div id="log-list" class="log-list"></div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-btn active" id="b1" onclick="go(1)">ğŸ“ é»åæ¿</div>
        <div class="nav-btn" id="b2" onclick="go(2)">ğŸ“Š æ•¸æ“šä¸­å¿ƒ</div>
    </div>

    <script>
        const layout = [2,0,0,6,20,10,21,12,23,25,34,3,1,33,39,4,19,15,18,24,30,40,5,16,35,29,9,36,32,14,37,17,31,8,7,22,11,26,38,0,0,0];
        
        function go(n) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('p'+n).classList.add('active');
            document.getElementById('b'+n).classList.add('active');
            if(n===2) updateStats();
        }

        function init() {
            const chart = document.getElementById('chart-container');
            const data = JSON.parse(localStorage.getItem('e3_st') || '{}');
            
            [13, 41].forEach(id => {
                const el = document.getElementById(`s-${id}`);
                el.className = `s mini ${data[id] || 'present'}`;
            });

            layout.forEach(id => {
                const el = document.createElement('div');
                if (id === 0) el.style.opacity = "0";
                else {
                    el.className = `s ${data[id] || 'present'}`;
                    el.id = `s-${id}`;
                    el.innerText = id;
                    el.onclick = () => t(id);
                }
                chart.appendChild(el);
            });
            setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('zh-TW', {hour12:false}); }, 1000);
            renderLogs();
            updateStats();
        }

        function t(id) {
            const el = document.getElementById(`s-${id}`);
            const isMini = el.classList.contains('mini');
            const now = new Date();
            const time = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0') + ":" + now.getSeconds().toString().padStart(2,'0');
            
            if(el.classList.contains('present')) el.className = isMini ? "s mini absent" : "s absent";
            else if(el.classList.contains('absent')) {
                el.className = isMini ? "s mini late" : "s late";
                let logs = JSON.parse(localStorage.getItem('e3_lg') || '[]');
                logs.unshift(`[${time}] åº§è™Ÿ ${id} åˆ°æ ¡`);
                localStorage.setItem('e3_lg', JSON.stringify(logs.slice(0, 50)));
                renderLogs();
            } else el.className = isMini ? "s mini present" : "s present";
            
            save(); updateStats();
        }

        function updateStats() {
            const a = document.querySelectorAll('.absent').length;
            const l = document.querySelectorAll('.late').length;
            document.getElementById('cnt-a').innerText = a;
            document.getElementById('cnt-l').innerText = l;
            document.getElementById('cnt-p').innerText = 41 - a;
        }

        function startGacha() {
            const ok = Array.from(document.querySelectorAll('.s:not(.absent)'));
            if(!ok.length) return;
            let i = 0;
            const timer = setInterval(() => {
                document.getElementById('gacha-num').innerText = ok[Math.floor(Math.random()*ok.length)].innerText;
                if(i++ > 15) clearInterval(timer);
            }, 50);
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('e3_lg') || '[]');
            document.getElementById('log-list').innerHTML = logs.map(t => `<div class="log-item">${t}</div>`).join('');
        }

        function save() {
            const d = {};
            document.querySelectorAll('.s').forEach(el => {
                const id = el.id ? el.id.split('-')[1] : el.innerText;
                d[id] = el.classList.contains('absent') ? 'absent' : (el.classList.contains('late') ? 'late' : 'present');
            });
            localStorage.setItem('e3_st', JSON.stringify(d));
        }

        window.onload = init;
    </script>
</body>
</html>
